<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;title&gt;æ¢ç¢¼ç›¤é»ç³»çµ±&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>body { padding: 20px; font-family: "Microsoft JhengHei", sans-serif; background-color: #f8f9fa; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.container { max-width: 800px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>/* æƒæå€åŸŸæ¨£å¼ */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#reader { width: 100%; min-height: 300px; background: #000; margin-bottom: 15px; border-radius: 5px; position: relative;}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>/* ç‹€æ…‹åˆ— */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#status-bar { font-weight: bold; margin-bottom: 10px; text-align: center; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.status-idle { color: #6c757d; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.status-scanning { color: #198754; animation: blink 1.5s infinite; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.status-paused { color: #ffc107; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>@keyframes blink { 50% { opacity: 0.5; } }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>/* è¡¨æ ¼æ¨£å¼ */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.count-badge { font-size: 1.1em; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.last-scanned { background-color: #e8f5e9 !important; transition: background-color 1s; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3 class="text-center mb-3"&gt;æ¢ç¢¼æƒæè¨ˆæ•¸å™¨&lt;/h3&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="status-bar" class="status-idle"&gt;ç›®å‰ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="reader"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="error-msg" class="alert alert-danger d-none"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="row g-2 mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="col-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button id="btn-start" class="btn btn-success w-100 py-3" onclick="startScanning()"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;i class="bi bi-play-fill"&gt;&lt;/i&gt; é–‹å§‹æƒæ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="col-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button id="btn-pause" class="btn btn-warning w-100 py-3 text-white" onclick="pauseScanning()" disabled&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;i class="bi bi-pause-fill"&gt;&lt;/i&gt; æš«åœ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="col-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button id="btn-finish" class="btn btn-primary w-100 py-3" onclick="finishAndExport()" disabled&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;i class="bi bi-file-earmark-excel"&gt;&lt;/i&gt; å®Œæˆä¸¦åŒ¯å‡º</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;hr&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="d-flex justify-content-between align-items-center mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;h4&gt;æƒææ¸…å–® (&lt;span id="total-count"&gt;0&lt;/span&gt; é …)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button class="btn btn-sm btn-outline-danger" onclick="clearData()"&gt;æ¸…ç©ºè¡¨æ ¼&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;table class="table table-bordered table-hover"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;thead class="table-dark"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;æ¢ç¢¼å…§å®¹ (Barcode)&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;th style="width: 100px;"&gt;æ•¸é‡&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;tbody id="table-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;tr&gt;&lt;td colspan="2" class="text-center text-muted"&gt;å°šæœªæƒæä»»ä½•æ¢ç¢¼&lt;/td&gt;&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/table&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script src="https://unpkg.com/html5-qrcode" type="text/javascript"&gt;&lt;/script&gt;</p>
<p class="p1">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"&gt;&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è®Šæ•¸å®£å‘Š ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let html5QrCode;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let scanData = {}; // æ ¼å¼: { "barcode1": 5, "barcode2": 3 }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let lastScannedCode = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let lastScanTime = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let isScanning = false;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- åˆå§‹åŒ– ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.onload = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// å»ºç«‹æƒæå™¨å¯¦ä¾‹ (ä½¿ç”¨ verbose=false æ¸›å°‘ log)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>html5QrCode = new Html5Qrcode("reader");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderTable();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- æ ¸å¿ƒåŠŸèƒ½ï¼šé–‹å§‹æƒæ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function startScanning() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const errorMsgDiv = document.getElementById('error-msg');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>errorMsgDiv.classList.add('d-none'); // éš±è—éŒ¯èª¤è¨Šæ¯</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// è¨­å®šæƒæåƒæ•¸</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const config = { fps: 10, qrbox: { width: 250, height: 250 }, aspectRatio: 1.0 };</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// å˜—è©¦å•Ÿå‹•ä¸»é¡é ­ (facingMode: "environment")</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>html5QrCode.start(</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ facingMode: "environment" },<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>config,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>onScanSuccess,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>onScanFailure</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>).then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>isScanning = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>updateUIState("scanning");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>console.log("æƒæå™¨å·²å•Ÿå‹•");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}).catch(err =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>console.error("å•Ÿå‹•å¤±æ•—", err);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>errorMsgDiv.innerText = "ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™æˆ–ä½¿ç”¨ HTTPS é€£ç·šã€‚";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>errorMsgDiv.classList.remove('d-none');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- æ ¸å¿ƒåŠŸèƒ½ï¼šæš«åœæƒæ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function pauseScanning() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (isScanning) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>html5QrCode.stop().then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>isScanning = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>updateUIState("paused");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("æƒæå·²æš«åœ");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('reader').innerHTML = ""; // æ¸…é™¤ç•«é¢</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}).catch(err =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("æš«åœå¤±æ•—", err);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- æ ¸å¿ƒåŠŸèƒ½ï¼šæƒææˆåŠŸå›å‘¼ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function onScanSuccess(decodedText, decodedResult) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const currentTime = new Date().getTime();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// é˜²é‡è¤‡æ©Ÿåˆ¶ (2ç§’å…§æƒåˆ°åŒä¸€å€‹ä¸è¨ˆæ•¸)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (decodedText === lastScannedCode &amp;&amp; (currentTime - lastScanTime &lt; 2000)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// 1. æ’­æ”¾éŸ³æ•ˆ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>playBeep();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// 2. æ›´æ–°é‚è¼¯</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>lastScannedCode = decodedText;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>lastScanTime = currentTime;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (scanData[decodedText]) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>scanData[decodedText]++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>scanData[decodedText] = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// 3. æ›´æ–°ä»‹é¢</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderTable();</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// 4. è¦–è¦ºå›é¥‹ (é–ƒçˆä¸€ä¸‹è¡¨ç¤ºæˆåŠŸ)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const readerDiv = document.getElementById('reader');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>readerDiv.style.border = "5px solid #28a745";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>setTimeout(() =&gt; { readerDiv.style.border = "none"; }, 200);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// å¿½ç•¥æƒæéç¨‹ä¸­çš„éŒ¯èª¤ (å¦‚æ­£åœ¨å°ç„¦)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function onScanFailure(error) {}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- æ ¸å¿ƒåŠŸèƒ½ï¼šå®Œæˆä¸¦åŒ¯å‡º ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function finishAndExport() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// å…ˆæš«åœæƒæ</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (isScanning) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>pauseScanning();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (Object.keys(scanData).length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>alert("ç›®å‰æ²’æœ‰ä»»ä½•è³‡æ–™ï¼Œç„¡æ³•å»ºç«‹è¡¨æ ¼ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// è®“ä½¿ç”¨è€…è¼¸å…¥æª”å</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let fileName = prompt("è«‹è¼¸å…¥æª”æ¡ˆåç¨±ï¼š", generateDefaultFileName());</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (fileName) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ç¢ºä¿æª”åæœ‰ .xlsx å¾Œç¶´</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!fileName.endsWith('.xlsx')) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>fileName += '.xlsx';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>exportToExcel(fileName);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è¼”åŠ©åŠŸèƒ½ï¼šç”¢ç”Ÿ Excel ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function exportToExcel(fileName) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const dataForExcel = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// å°‡ç‰©ä»¶è½‰ç‚ºé™£åˆ—</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (const [code, qty] of Object.entries(scanData)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dataForExcel.push({ "æ¢ç¢¼å…§å®¹": code, "æ•¸é‡": qty });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const wb = XLSX.utils.book_new();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const ws = XLSX.utils.json_to_sheet(dataForExcel);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// è¨­å®šæ¬„å¯¬ (ç¾è§€)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const wscols = [ {wch:30}, {wch:10} ];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ws['!cols'] = wscols;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>XLSX.utils.book_append_sheet(wb, ws, "ç›¤é»çµæœ");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>XLSX.writeFile(wb, fileName);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è¼”åŠ©åŠŸèƒ½ï¼šæ›´æ–°è¡¨æ ¼ UI ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function renderTable() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tbody = document.getElementById('table-body');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const totalCountSpan = document.getElementById('total-count');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tbody.innerHTML = "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const entries = Object.entries(scanData);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>totalCountSpan.innerText = entries.length;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (entries.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="2" class="text-center text-muted"&gt;å°šæœªæƒæä»»ä½•æ¢ç¢¼&lt;/td&gt;&lt;/tr&gt;';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// åè½‰é™£åˆ—ï¼Œè®“æœ€æ–°æƒæçš„é¡¯ç¤ºåœ¨æœ€ä¸Šé¢</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// æˆ‘å€‘å¯ä»¥æŠŠæœ€å¾Œæƒæçš„é‚£å€‹ç‰¹åˆ¥æ¨™è¨˜å‡ºä¾†</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const reversedEntries = [...entries].reverse();<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>reversedEntries.forEach(([code, qty]) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const isLastScanned = (code === lastScannedCode);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const rowClass = isLastScanned ? "last-scanned" : "";</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const row = `&lt;tr class="${rowClass}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;td class="align-middle"&gt;${code}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;td&gt;&lt;span class="badge bg-primary count-badge"&gt;${qty}&lt;/span&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/tr&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tbody.innerHTML += row;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è¼”åŠ©åŠŸèƒ½ï¼šç‹€æ…‹ç®¡ç† ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateUIState(state) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const btnStart = document.getElementById('btn-start');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const btnPause = document.getElementById('btn-pause');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const btnFinish = document.getElementById('btn-finish');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const statusBar = document.getElementById('status-bar');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (state === "scanning") {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnStart.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnPause.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnFinish.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.innerText = "ğŸŸ¢ æ­£åœ¨æƒæä¸­... (è«‹å°æº–æ¢ç¢¼)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.className = "status-scanning";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else if (state === "paused") {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnStart.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnStart.innerHTML = '&lt;i class="bi bi-play-fill"&gt;&lt;/i&gt; ç¹¼çºŒæƒæ';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnPause.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>btnFinish.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.innerText = "ğŸŸ¡ å·²æš«åœ";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.className = "status-paused";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// idle</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.innerText = "âšª å¾…æ©Ÿä¸­";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>statusBar.className = "status-idle";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è¼”åŠ©åŠŸèƒ½ï¼šæ¸…ç©ºè³‡æ–™ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function clearData() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(confirm("ç¢ºå®šè¦æ¸…ç©ºç›®å‰æ‰€æœ‰åˆ—è¡¨è³‡æ–™å—ï¼Ÿ")) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>scanData = {};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>lastScannedCode = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderTable();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- è¼”åŠ©åŠŸèƒ½ï¼šéŸ³æ•ˆ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function playBeep() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const audioCtx = new (window.AudioContext || window.webkitAudioContext)();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const oscillator = audioCtx.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const gainNode = audioCtx.createGain();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oscillator.connect(gainNode);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>gainNode.connect(audioCtx.destination);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oscillator.type = 'sine';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oscillator.frequency.setValueAtTime(1200, audioCtx.currentTime); // è¼ƒé«˜é »æ¸…è„†è²éŸ³</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oscillator.start();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oscillator.stop(audioCtx.currentTime + 0.1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} catch(e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>console.log("Audio play failed"); // éƒ¨åˆ†ç€è¦½å™¨é™åˆ¶è‡ªå‹•æ’­æ”¾</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// ç”¢ç”Ÿé è¨­æª”å</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function generateDefaultFileName() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const date = new Date();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const mm =String(date.getMonth() + 1).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const dd = String(date.getDate()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const hh = String(date.getHours()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const min = String(date.getMinutes()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>return `ç›¤é»è¡¨_${mm}${dd}_${hh}${min}.xlsx`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1">&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
